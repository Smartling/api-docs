components:
  responses:
    Error400ResponseDefinition:
      description: Provided request parameters are invalid.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Error401ResponseDefinition:
      description: Authentication failed.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Error404ResponseDefinition:
      description: Resource not found.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Error429ResponseDefinition:
      description: Rate limit exceeded.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Error500ResponseDefinition:
      description: Internal server error.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
  schemas:
    SubscriptionListResponse:
      type: object
      properties:
        response:
          type: object
          properties:
            data:
              type: object
              properties:
                totalCount:
                  type: integer
                  example: 1
                items:
                  type: array
                  items:
                    $ref: '#/components/schemas/SubscriptionDTO'
    SubscriptionResponse:
      type: object
      properties:
        response:
          type: object
          properties:
            data:
              $ref: '#/components/schemas/SubscriptionDTO'
    SubscriptionDTO:
      type: object
      properties:
        subscriptionUid:
          type: string
          example: "111122223333"
        subscriptionName:
          type: string
          example: "SourceIssue Created Subscription"
        subscriptionUrl:
          type: string
          format: uri
          example: "https://myurl.com/webhooks"
        accountUid:
          type: string
          example: "111222333"
        enabled:
          type: boolean
          example: true
        userUid:
          type: string
          example: "111122223333"
        description:
          type: string
          example: "My subscription"
        createdDate:
          type: string
          format: date-time
          example: "2025-09-10T19:00:00Z"
        requestHeaders:
          type: array
          items:
            type: object
            properties:
              headerName:
                type: string
                example: "CustomHeader1"
              headerValue:
                type: string
                example: "HeaderValue1"
            required:
              - headerName
              - headerValue
        events:
          type: array
          items:
            type: object
            properties:
              type:
                type: string
                example: "sourceIssue.comment.created"
              schemaVersion:
                type: string
                example: "1.0"
            required:
              - type
              - schemaVersion
        projectUids:
          type: array
          items:
            type: string
          example: [ "111222333" ]
    CreateSubscriptionCommand:
      type: object
      properties:
        subscriptionName:
          type: string
          description: Display name for the subscription.
          example: "SourceIssue Created Subscription"
        subscriptionUrl:
          type: string
          description: HTTPS endpoint that will receive webhook deliveries.
          example: "https://myurl.com/webhooks"
        description:
          type: string
          description: Human-readable description.
          example: "My subscription"
        payloadSecret:
          type: string
          writeOnly: true
          description: Secret used to sign webhook deliveries.
          example: "mySuperLongAndSecurePayloadSecret"
        requestHeaders:
          type: array
          description: Custom HTTP headers to include with each delivery.
          items:
            type: object
            additionalProperties: false
            properties:
              headerName:
                type: string
                example: "CustomHeader1"
              headerValue:
                type: string
                example: "HeaderValue1"
            required:
              - headerName
              - headerValue
        events:
          type: array
          minItems: 1
          description: Event types to subscribe to.
          items:
            type: object
            additionalProperties: false
            properties:
              type:
                type: string
                example: "sourceIssue.comment.created"
              schemaVersion:
                type: string
                example: "1.0"
            required:
              - type
              - schemaVersion
        projectUids:
          type: array
          description: Optional array of unique project identifiers. If no ids are provided, all projects in the account are included by default.
          items:
            type: string
            example: "111222333"
      required:
        - subscriptionName
        - subscriptionUrl
        - events
    EventTypeListResponse:
      type: object
      properties:
        response:
          type: object
          properties:
            data:
              type: object
              properties:
                totalCount:
                  type: string
                  example: 1
                items:
                  type: array
                  items:
                    $ref: '#/components/schemas/EventTypeDTO'
    EventTypeDTO:
      type: object
      properties:
        eventType:
          type: string
        description:
          type: string
        schema:
          type: object
          example: ...
    PatchSubscriptionCommand:
      type: object
      properties:
        subscriptionName:
          type: string
          description: Display name for the subscription.
          example: "SourceIssue Created Subscription"
        description:
          type: string
          description: Human-readable description.
          example: "My subscription"
        requestHeaders:
          type: array
          description: Custom HTTP headers to include with each delivery.
          items:
            type: object
            additionalProperties: false
            properties:
              headerName:
                type: string
                example: "CustomHeader1"
              headerValue:
                type: string
                example: "HeaderValue1"
            required:
              - headerName
              - headerValue
        events:
          type: array
          minItems: 1
          description: Event types to subscribe to.
          items:
            type: object
            additionalProperties: false
            properties:
              type:
                type: string
                example: "sourceIssue.comment.created"
              schemaVersion:
                type: string
                example: "1.0"
            required:
              - type
              - schemaVersion
        projectUids:
          type: array
          description: Optional array of unique project identifiers. If no ids are provided, all projects in the account are included by default.
          items:
            type: string
            example: "111222333"
    UpdateSubscriptionSecretCommand:
      type: object
      properties:
        payloadSecret:
          type: string
          description: Secret used to sign webhook deliveries.
          example: "mySuperLongAndSecurePayloadSecret"
    SubscriptionStatisticsResponse:
      type: object
      additionalProperties: false
      description: Statistics summary for a specific subscription, representing delivery outcomes.
      properties:
        failEvents:
          type: integer
          format: int64
          description: Number of webhook events that failed to deliver after all retries.
          example: 0
        pendingEvents:
          type: integer
          format: int64
          description: Number of webhook events waiting to be processed or retried.
          example: 0
        sendingEvents:
          type: integer
          format: int64
          description: Number of webhook events currently being delivered.
          example: 0
        successEvents:
          type: integer
          format: int64
          description: Number of webhook events successfully delivered.
          example: 0
      required:
        - failEvents
        - pendingEvents
        - sendingEvents
        - successEvents
    AttemptsListResponse:
      type: object
      additionalProperties: false
      properties:
        totalCount:
          type: integer
          format: int64
          minimum: 0
          description: Total number of attempts matching the query.
          example: 1
        items:
          type: array
          description: Page of delivery attempts.
          items:
            type: object
            additionalProperties: false
            properties:
              attemptId:
                type: string
                description: Unique identifier of the attempt.
                example: "atmpt_35BMZB5jYVpNpnZ2kTfBK8Hwi0d"
              eventId:
                type: string
                format: uuid
                description: Identifier of the related event.
                example: "4c88083c-9135-450f-b724-67d9a811c855"
              response:
                type: string
                description: Raw response body returned by the destination endpoint (as a string).
                example: "{\"success\":false,\"error\":{\"message\":\"Token \\\"3a4f060c-e7ec-4269-bcec-125327d0950d\\\" not found\",\"id\":\"\"}}"
              responseDurationMs:
                type: integer
                format: int64
                minimum: 0
                description: Time taken for the destination to respond, in milliseconds.
                example: 414
              responseStatusCode:
                type: integer
                minimum: 100
                maximum: 599
                description: HTTP status code returned by the destination.
                example: 404
              attemptStatus:
                type: string
                description: Final status of this attempt.
                enum: [ SUCCESS, PENDING, FAIL, SENDING ]
                example: "FAIL"
              attemptDate:
                type: string
                format: date-time
                description: Timestamp when the attempt was made.
                example: "2025-11-08T05:17:44Z"
              url:
                type: string
                format: uri
                description: Destination URL used for this attempt.
                example: "https://myurl.site/webhooks"
              triggerType:
                type: string
                description: What triggered this attempt (e.g., scheduled retry, immediate send).
                example: "SCHEDULED"
            required:
              - attemptId
              - eventId
              - response
              - responseDurationMs
              - responseStatusCode
              - attemptStatus
              - attemptDate
              - url
              - triggerType
      required:
        - totalCount
        - items
    ErrorResponse:
      type: object
      properties:
        error:
          type: object
          properties:
            code:
              type: string
            message:
              type: string
            details:
              type: string
    ValidationErrorResponse:
      type: object
      properties:
        error:
          type: object
          properties:
            code:
              type: string
            message:
              type: string
            validationErrors:
              type: array
              items:
                type: object
                properties:
                  field:
                    type: string
                  message:
                    type: string
