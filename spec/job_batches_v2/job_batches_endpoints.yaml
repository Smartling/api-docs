x-paths:
  create_list_batches:
    post:
      summary: Create batch
      description: >-
        Creates a new batch for the given Job with a list of file names to be uploaded.
        File names can be added while files are uploading to the batch, but only before the batch will start executing.
        The batch is executed as soon as the last file in the initial list or added files are uploaded or cancelled
      tags:
        - Job Batches V2
      operationId: createJobBatchV2

      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            format: uid
            type: string
          description: Unique identifier of the project within an account.

      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateBatchRequestV2'
        description: Create Batch Request
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateBatchResponse'
              examples:
                response:
                  value:
                    response:
                      code: SUCCESS
                      data:
                        batchUid: qwe0rty98poi
        404:
          description: provided translationJobUid is not found in the TMS
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error400Response'
              examples:
                response:
                  value:
                    response:
                      code: VALIDATION_ERROR
                      errors:
                        key: job.not.found
                        message: >-
                          Job {translationJobUid} not found for project {projectId}.
        400:
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error400Response'
              examples:
                duplicate_file_uris:
                  value:
                    response:
                      code: VALIDATION_ERROR
                      errors:
                        - key: batch.not.created
                          message: "All fileUris must be unique"
                missing_required_fields:
                  value:
                    response:
                      code: VALIDATION_ERROR
                      errors:
                        - key: translationJobUid
                          message: "Parameter 'translationJobUid' has invalid value 'null'"
                        - key: fileUris
                          message: "Parameter 'fileUris' has invalid value 'null'"
                invalid_schedule_modification:
                  value:
                    response:
                      code: VALIDATION_ERROR
                      errors:
                        - key: batch.schedule.invalid
                          message: "Batch with authorized='false' does not support translation job schedule modification"
                invalid_user_assignment:
                  value:
                    response:
                      code: VALIDATION_ERROR
                      errors:
                        - key: userUids
                          message: "Parameter 'userUids' has invalid value '[]' (must contain exactly 1 user)"
                invalid_due_date_format:
                  value:
                    response:
                      code: VALIDATION_ERROR
                      errors:
                        - key: dueDate
                          message: "Wrong due date format"
        401:
          $ref: '#/components/responses/Error401ResponseDefinition'
        500:
          $ref: '#/components/responses/Error500ResponseDefinition'
      x-code-samples:
        - lang: curl
          source: >
            curl -X POST
            "https://api.smartling.com/job-batches-api/v2/projects/$smartlingProjectId/batches"
            -H "Authorization: Bearer $smartlingToken" -H "Content-Type:
            application/json" -d '{"translationJobUid": "$translationJobUid", "authorize": true, "fileUris": ["example.json", "test.xml"], "localeWorkflows": [{"targetLocaleId": "fr-FR", "workflowUid": "2b91c391d71a"}]}'

    get:
      summary: List batches
      description: 'List existing batches for the project, filtered by the given criteria.'
      tags:
        - Job Batches V2
      operationId: getJobBatchesListV2

      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            format: uid
            type: string
          description: Unique identifier of the project within an account.
        - description: A unique identifier for a translationJob.
          in: query
          name: translationJobUid
          schema:
            format: uid
            type: string
        - description: The status of the Batch
          in: query
          name: status
          schema:
            $ref: '#/components/schemas/BatchStatus'
        - description: The field to sort by
          in: query
          name: sortBy
          schema:
            default: createdDate
            enum:
              - createdDate
              - status
            type: string
        - description: Sorting direction
          in: query
          name: orderBy
          schema:
            default: desc
            enum:
              - asc
              - desc
            type: string
        - description: >-
            Standard Smartling limit and offset to paginate through results. 0
            if not specified.
          in: query
          name: offset
          schema:
            default: 0
            type: integer
        - description: >-
            Standard Smartling limit and offset to paginate through results. 20
            batches are returned by default if not specified.
          in: query
          name: limit
          schema:
            default: 20
            maximum: 100
            minimum: 1
            type: integer
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListBatchesResponse'
              examples:
                response:
                  value:
                    response:
                      code: SUCCESS
                      data:
                        items:
                          - authorized: 'true'
                            batchUid: 559ce40f2789
                            createdDate: '2015-11-21T11:51:17Z'
                            hasError: 'false'
                            modifiedDate: '2015-11-21T11:51:17Z'
                            projectId: asf53fds34
                            status: DRAFT
                            translationJobUid: 635gf40f9846
                          - authorized: 'true'
                            batchUid: 456dv32d0934
                            createdDate: '2015-11-21T11:51:17Z'
                            hasError: 'false'
                            modifiedDate: '2015-11-22T10:24:14Z'
                            projectId: asf53fds34
                            status: EXECUTING
                            translationJobUid: 635gf40f9846
                        totalCount: 2
        400:
          $ref: '#/components/responses/Error400ResponseDefinition'
        401:
          $ref: '#/components/responses/Error401ResponseDefinition'
        500:
          $ref: '#/components/responses/Error500ResponseDefinition'
      x-code-samples:
        - lang: curl
          source: |
            curl -X GET \
            'https://api.smartling.com/job-batches-api/v2/projects/$smartlingProjectId/batches?translationJobUid={translationJobUid}&status={status}&sortBy=createdDate&orderBy=desc&offset=0&limit=20' \
            -H "Authorization: Bearer $smartlingToken"

  status_process_batch:
    get:
      summary: Get batch status
      description: >-
        Returns batch status with detailed statuses of all batch items and their
        locales.
      tags:
        - Job Batches V2
      operationId: getJobBatchStatusV2

      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            format: uid
            type: string
          description: Unique identifier of the project within an account.
        - name: batchUid
          in: path
          required: true
          schema:
            format: uid
            type: string
          description: A unique identifier for a batch.

      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BatchStatusResponseV2'
              examples:
                response:
                  value:
                    response:
                      code: OK
                      data:
                        authorized: 'true'
                        files:
                          - errors: ''
                            fileUri: files/example1.json
                            status: ATTACHING
                            targetLocales:
                              - localeId: de-DE
                                stringsAdded: 0
                              - localeId: fr-FR
                                stringsAdded: 0
                            updatedDate: '2015-11-21T11:53:17Z'
                          - errors: ''
                            fileUri: files/example2.xml
                            status: UPLOADING
                            targetLocales:
                              - localeId: de-DE
                                stringsAdded: 0
                              - localeId: fr-FR
                                stringsAdded: 0
                            updatedDate: '2015-11-21T11:54:19Z'
                        generalErrors: ''
                        projectId: dg63gkb4v
                        status: ADDING_FILES
                        translationJobUid: sjhs782hdb4djf
                        updatedDate: '2015-11-21T11:51:17Z'
        404:
          description: Batch provided in path is not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error400Response'
              examples:
                response:
                  value:
                    response:
                      code: VALIDATION_ERROR
                      errors:
                        key: batch.not.found
                        message: >-
                          Batch with uid={batchUid} and projectId={projectId}
                          not found.
        400:
          $ref: '#/components/responses/Error400ResponseDefinition'
        401:
          $ref: '#/components/responses/Error401ResponseDefinition'
        500:
          $ref: '#/components/responses/Error500ResponseDefinition'

    put:
      summary: Process batch action
      description: |
        Supports two batch actions:
        
        **REGISTER_FILE** - Adds given file URI to the initial file name list for uploading.
        Creates a new batchItem if the batch is in ADDING_FILES status.
        
        **CANCEL_FILE** - Indicates that file will not be uploaded.  
        Changes batchItem status to CANCELED and writes reason to "errors" column.
      tags:
        - Job Batches V2
      operationId: processBatchActionV2

      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            format: uid
            type: string
          description: Unique identifier of the project within an account.
        - name: batchUid
          in: path
          required: true
          schema:
            format: uid
            type: string
          description: A unique identifier for a batch.

      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BatchActionRequestV2'
      responses:
        200:
          description: SUCCESS
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EmptyResponse'
              examples:
                response:
                  value:
                    response:
                      code: SUCCESS
        404:
          description: Batch provided in path is not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error400Response'
              examples:
                response:
                  value:
                    response:
                      code: VALIDATION_ERROR
                      errors:
                        key: batch.not.found
                        message: >-
                          Batch with uid={batchUid} and projectId={projectId}
                          not found.
        400:
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error400Response'
              examples:
                file_not_registered:
                  value:
                    response:
                      code: VALIDATION_ERROR
                      errors:
                        - key: file.not.registered
                          message: "File URI not registered in batch"
                file_not_canceled:
                  value:
                    response:
                      code: VALIDATION_ERROR
                      errors:
                        - key: file.not.cancelled
                          message: "Failed to cancel file"
                batch_not_suitable:
                  value:
                    response:
                      code: VALIDATION_ERROR
                      errors:
                        - key: batch.not.suitable
                          message: "Batch is not in suitable state for this action"
        401:
          $ref: '#/components/responses/Error401ResponseDefinition'
        500:
          $ref: '#/components/responses/Error500ResponseDefinition'
      x-code-samples:
        - lang: curl
          source: |
            curl -X PUT \
            'https://api.smartling.com/job-batches-api/v2/projects/$smartlingProjectId/batches/$batchUid' \
            -H "Authorization: Bearer $smartlingToken" \
            -H "Content-Type: application/json" \
            -d '{ "action": "CANCEL_FILE", "fileUri": "file1.xml", "reason": "Requested asset doesn't exist in Zendesk" }'

  add_file_to_batch:
    post:
      summary: Upload file to a batch
      description: |-
        This endpoint is actually a proxy for Upload File in the Files API, and
        it works with these two differences:
         1. It additionally gets `batchUid` as a path parameter.
         2. It doesn't relay `localeIdsToAuthorize` to Files Api, therefore the file stays unauthorized. Instead, `localeIdsToAuthorize` are saved just for this batch session and are used when a file is being attached to a job.

        Upload is only possible if the file was declared in the `Create Batch` request or added with `REGISTER_FILE` action.
        When the first file is uploaded to the new batch, the batch status changes
        to `ADDING_FILES`. Adds original source content to a Job batch in Smartling.

        The provided curl example will upload your Java properties file directly
        to a Smartling project, identified by the `projectId`, and attaches it
        to a Job linked to `batchUid`. The response is returned right after the
        content of a file is accepted by the Files API. After that, the Batch
        service controls whether the file upload finished. Content is parsed,
        all strings are ingested, and the file is then attached to the Job which
        is linked to the batch for locales, described in `localeIdsToAuthorize`.

        Endpoint returns response as soon as a file is uploaded to job batches server.
        File is uploaded to FILE API asynchronously.

        **Common issues**:

        * Each file must include the `fileUri` registered with the batch, upon upload. For example, if you have created a batch with the single file URI `test1.xml` and you attempt to upload this with the file URI `test2.xml` it will fail, and you will get an error. But you can always use `REGISTER_FILE` action.
        * File URI's must be unique per batch, even if you want to authorize it to two or more locales. For example, if you have file `test1.xml` that should be authorized for `es` and `de`, and you attempt to upload it twice (`fileUri=test1.xml` + `localeIdsToAuthorize[]=es` and `fileUri=test1.xml` + `localeIdsToAuthorize[]=de`), it will fail and you will get an error. The second upload will be rejected and file will be authorized only for `es` locale. You must always pass all desired locales with the registered fileUri (`fileUri=test1.xml` + `localeIdsToAuthorize[]=es,de`).
      tags:
        - Job Batches V2
      operationId: uploadFileToJobBatchV2

      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            format: uid
            type: string
          description: Unique identifier of the project within an account.
        - name: batchUid
          in: path
          required: true
          schema:
            format: uid
            type: string
          description: A unique identifier for a batch.

      requestBody:
        content:
          multipart/form-data:
            schema:
              properties:
                file:
                  type: string
                  format: binary
                  description: The file contents to upload.
                fileUri:
                  description: >
                    A value that uniquely identifies the uploaded file. This ID
                    can be used to request the file back. We recommend that you
                    use file path and file name, similar to how version control
                    systems identify the file.


                    Example: `/myproject/i18n/ui.properties`
                  type: string
                fileType:
                  $ref: '#/components/schemas/FileType'
                authorize:
                  default: false
                  description: >
                    Ignored

                    Endpoint accepts this field to be consistent with `File
                    Upload` but it doesn't relay it to File Api
                  type: boolean
                'localeIdsToAuthorize[]':
                  description: >
                    This value declares locales list which should be used when
                    file is attached to a job.


                    **Note**: File will not be authorized for these locales once
                    it is uploaded. Authorization happens only when a job is
                    authorized.
                  items:
                    type: string
                  type: array
                smartling.namespace:
                  description: >
                    This is only for accounts created after July 31st, 2015.
                    Define a custom
                    [namespace](https://help.smartling.com/hc/en-us/articles/360008143833)
                    for the file.


                    **Note**: While this parameter shares the format of other
                    file directives, it will not work as an inline directive and
                    must be specified in the API call.
                  type: string
                smartling.file_charset:
                  description: >
                    Specifies a custom charset for text-format files. The value
                    should be the name of the character set. See a full list of
                    supported character sets here.


                    If this directive is not used, Smartling will use the
                    ```Content-Type``` request header to determine if the
                    content is encoded with UTF-16, UTF-16B or UTF-16LE. If
                    there is no ```Content-Type``` header, Smartling will
                    examine the file for UTF-16 characters. If none are
                    detected, UTF-8 encoding will be used.


                    **Note**: Once this property has been set for a file, it
                    cannot be changed. If you reupload the file, it will use the
                    original charset, even if you change the directive. An error
                    will be returned if this directive is used when uploading
                    binary-format file types, such as Office or IDML files.
                  type: string
                'smartling.[command]':
                  description: >
                    Provides custom parser configuration for supported file
                    types. See [Supported File
                    Types](https://help.smartling.com/hc/en-us/articles/360007998893)
                    for more details.
                  type: string
                callbackUrl:
                  description: >
                    A GET request that creates a callback to a URL when a file
                    is 100% published for a locale. The callback gives the
                    fileUri and locale with the format
                    `http[/s]://your.url?locale=xx-XX&fileUri=your.file`. If you
                    upload the file again, without a callbackUrl, it will remove
                    any previous callbackUrl for that file. The RequestBin
                    (http://requestb.in) service is a convenient way to test
                    callback. RequestBin generates a short-lived disposable URL
                    that displays all posted requests.


                    If a callback fails, Smartling will make multiple attempts
                    to reach the designated URL, however, we do not keep
                    retrying a failed callback indefinitely. Try to make sure
                    your callback URL is as stable as possible and be aware that
                    callbacks are not a 100% reliable way of being notified that
                    a file is published.


                    If the upload has begun but is taking more than a minute to
                    complete, it responds with status `202`.
                  format: url
                  type: string
              required:
                - file
                - fileUri
                - fileType
                - localeIdsToAuthorize[]
              type: object
        required: true
      responses:
        202:
          description: ACCEPTED
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EmptyResponse'
              examples:
                response:
                  value:
                    response:
                      code: ACCEPTED
                      data:
        404:
          description: Batch provided in path is not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error400Response'
              examples:
                response:
                  value:
                    response:
                      code: VALIDATION_ERROR
                      errors:
                        key: batch.not.found
                        message: >-
                          Batch with uid={batchUid} and projectId={projectId}
                          not found.
        429:
          $ref: '#/components/responses/Error429ResponseDefinition'
        400:
          $ref: '#/components/responses/Error400ResponseDefinition'
        401:
          $ref: '#/components/responses/Error401ResponseDefinition'
        500:
          $ref: '#/components/responses/Error500ResponseDefinition'
      x-code-samples:
        - lang: curl
          source: |
            curl -X POST \
            'https://api.smartling.com/job-batches-api/v2/projects/$smartlingProjectId/batches/{batchUid}/file' \
            -H "Authorization: Bearer $smartlingToken" \
            -F "file=@file.properties;type=text/plain" \
            -F "fileUri=file.properties" \
            -F "fileType=javaProperties" \
            -F "localeIdsToAuthorize[]=fr-FR" \
            -F "localeIdsToAuthorize[]=ru-RU"

  create_job:
    post:
      summary: Create translation job
      description: |
        Creates a new translation job or fetches an existing one based on the specified criteria.
        
        The behavior depends on the `mode` parameter:
        
        - **REUSE_EXISTING**: Returns an existing job if one matches the name template
        - **CREATE_NEW**: Always creates a new job with unique naming based on the salt parameter
      tags:
        - Job Batches V2
      operationId: createJobV2

      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            format: uid
            type: string
          description: Unique identifier of the project within an account.

      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/JobBatchCreateJobRequest'
        description: Create Job Request
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobBatchCreateJobResponse'
              examples:
                response:
                  value:
                    response:
                      code: SUCCESS
                      data:
                        translationJobUid: abc123def456
                        jobName: "Localization Project Q2 2024"
                        jobNumber: "JOB-2024-001"
                        dueDate: "2024-06-30T23:59:59Z"
                        targetLocaleIds: ["fr-FR", "de-DE", "es-ES"]
                        createdDate: "2024-03-15T10:30:00Z"
                        jobStatus: "AWAITING_AUTHORIZATION"
                        referenceNumber: "REF-Q2-2024"
                        description: "Q2 2024 product localization"
        400:
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error400Response'
              examples:
                missing_name_template:
                  value:
                    response:
                      code: VALIDATION_ERROR
                      errors:
                        - key: nameTemplate
                          message: "Parameter 'nameTemplate' has invalid value 'null'"
                job_name_evaluation_failed:
                  value:
                    response:
                      code: VALIDATION_ERROR
                      errors:
                        - key: job.name.evaluation.failed
                          message: "Failed to evaluate job name from template"
        401:
          $ref: '#/components/responses/Error401ResponseDefinition'
        500:
          $ref: '#/components/responses/Error500ResponseDefinition'
      x-code-samples:
        - lang: curl
          source: >
            curl -X POST
            "https://api.smartling.com/job-batches-api/v2/projects/$smartlingProjectId/jobs"
            -H "Authorization: Bearer $smartlingToken" -H "Content-Type:
            application/json" -d '{"nameTemplate": "Localization Project Q2 2024", "description": "Q2 2024 product localization", "targetLocaleIds": ["fr-FR", "de-DE"], "mode": "REUSE_EXISTING", "salt": "RANDOM_ALPHANUMERIC", "timeZoneName": "America/New_York"}'

components:
  schemas:
    JobBatchCreateJobRequest:
      description: The payload to use when creating a translation job.
      required:
        - nameTemplate
      properties:
        nameTemplate:
          description: The name template for the job. Used to identify or create the job. Must be a non-empty string.
          type: string
          minLength: 1
        description:
          description: Optional description for the job.
          type: string
        targetLocaleIds:
          description: List of target locale IDs for the job.
          type: array
          items:
            type: string
        mode:
          $ref: '#/components/schemas/JobBatchJobCreationMode'
        salt:
          $ref: '#/components/schemas/JobBatchJobCreationSalt'
        timeZoneName:
          description: Time zone name for the job (e.g., "America/New_York").
          type: string
      type: object
    JobBatchCreateJobResponse:
      type: object
      required:
        - response
      properties:
        response:
          allOf:
            - $ref: '#/components/schemas/SuccessResponse'
            - properties:
                data:
                  properties:
                    translationJobUid:
                      description: The unique identifier of the translation job.
                      type: string
                    jobName:
                      description: The name of the job.
                      type: string
                    jobNumber:
                      description: The job number.
                      type: string
                    dueDate:
                      description: The due date of the job in ISO 8601 format.
                      type: string
                    targetLocaleIds:
                      description: List of target locale IDs for the job.
                      type: array
                      items:
                        type: string
                    createdDate:
                      description: The creation date of the job in ISO 8601 format.
                      type: string
                    jobStatus:
                      description: The current status of the job.
                      type: string
                    referenceNumber:
                      description: The reference number for the job.
                      type: string
                    description:
                      description: The description of the job.
                      type: string
                  type: object
              type: object
      description: Info about created or fetched translation job.
    JobBatchJobCreationMode:
      type: string
      enum:
        - CREATE_NEW
        - REUSE_EXISTING
      description: >-
        Determines job creation behavior:
        - CREATE_NEW: Always creates a new job with unique naming
        - REUSE_EXISTING: Returns existing job if one matches the name template
    JobBatchJobCreationSalt:
      type: string
      enum:
        - RANDOM_ALPHANUMERIC
        - TIMESTAMP
      description: >-
        Determines how unique identifiers are generated when creating new jobs:
        - RANDOM_ALPHANUMERIC: Uses random alphanumeric characters
        - TIMESTAMP: Uses timestamp-based identifiers
